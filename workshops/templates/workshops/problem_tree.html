<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Problem Tree for {{ project.title }}</title>
<style>
        body { font-family: "Lato", sans-serif; display: flex; gap: 2em; margin: 2em; background-color: #f8f9fa; }
        .main-content { flex: 3; }
        .sidebar { flex: 2; }
        h1, h2 { font-family: "Lora", serif; color: #212529; }

        .problem-tree-container {
            display: flex;
            flex-direction: column;
            align-items: center; /* Center core and lists */
            margin-bottom: 3em;
            padding: 2.5em 1.5em; /* More vertical padding */
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
            position: relative;
        }

        /* General list styling */
        .tree ul {
            list-style-type: none;
            position: relative;
            padding: 0; margin: 0;
            display: flex; /* Arrange children horizontally */
            justify-content: center; /* Center horizontally */
        }
        .tree li {
            position: relative;
            /* Increased top padding slightly more */
            padding: 21px 5px 0 5px;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* --- Connecting Lines --- */
        /* Vertical line coming DOWN TO node */
        .tree li::before {
            content: '';
            position: absolute;
             /* Start slightly higher */
            top: -1px;
            left: 50%;
            transform: translateX(-50%);
            border-left: 1px solid #aaa;
            width: 0px;
             /* Make line slightly longer */
            height: 22px;
        }
        /* Horizontal line connecting siblings ABOVE nodes */
        .tree li::after {
            content: '';
            position: absolute;
            /* Align with top of vertical line */
            top: 0;
            left: 0;
            border-top: 1px solid #aaa;
            width: 100%; height: 0px;
        }

        /* Adjustments for line connections */
        .tree li:first-child::after { left: 50%; width: 50%; } /* First sibling's line */
        .tree li:last-child::after { width: 50%; } /* Last sibling's line */
        .tree li:only-child::after { display: none; } /* No horizontal line for single child */

        /* Connect Core Problem to lists */
        /* Line DOWN from Core to Causes list */
        .causes-section > ul::before {
            content: '';
            position: absolute;
            /* Adjust based on li padding */
            top: -21px;
            left: 50%;
            transform: translateX(-50%);
            border-left: 1px solid #aaa;
            /* Make slightly longer */
            width: 0px; height: 21px;
        }
         /* Line UP from Core to Effects list */
        .effects-section > ul::after {
            content: '';
            position: absolute;
            /* Adjust based on li padding */
            bottom: -21px;
            left: 50%;
            transform: translateX(-50%);
            border-left: 1px solid #aaa;
            /* Make slightly longer */
            width: 0px; height: 21px;
        }
        /* No lines coming INTO the top-level items */
        .effects-section > ul > li::before,
        .causes-section > ul > li::before {
             display: none;
        }
        /* No horizontal sibling lines for top-level items */
        .effects-section > ul > li::after,
        .causes-section > ul > li::after {
             display: none;
        }

        /* Position nested lists correctly */
        .tree li ul { margin-top: 0; }

        /* Styles for the problem/cause/effect boxes */
        .problem-node { display: inline-block; padding: 8px 12px; margin: 0; border-radius: 5px; border: 1px solid; min-width: 150px; position: relative; background-color: #fff; z-index: 1; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
        .core-problem { background-color: #ffc107; border-color: #e0a800; text-align: center; display: block; margin: 21px 0; padding: 15px; font-weight: bold; position: relative; z-index: 1; } /* Adjusted margin */
        .effect-problem { background-color: #f8d7da; border-color: #f5c6cb; }
        .cause-problem { background-color: #cfe2ff; border-color: #b6d4fe; }

        /* Sidebar and Form */
        .sidebar-card { background-color: #fff; padding: 1.5em; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        button { background-color: #003366; color: white; padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <div class="main-content">
        <h1>Problem Tree: {{ project.title }}</h1>

        {% for tree_data in problem_trees_data %}
            <div class="problem-tree-container tree">
                <div class="effects-section">
                    <ul>
                        {% for effect in tree_data.effects %}
                        <li>
                            <div class="problem-node effect-problem">{{ effect.description }}</div>
                        </li>
                        {% endfor %}
                    </ul>
                </div>

                <div class="problem-node core-problem">{{ tree_data.core.description }}</div>

                <div class="causes-section">
                    {% include "workshops/_problem_branch.html" with problems=tree_data.causes %}
                </div>
            </div>
        {% empty %}
            <p>No Core Problems have been added yet. Start by adding one using the form.</p>
        {% endfor %}
    </div>

    <div class="sidebar">
        <div class="sidebar-card">
            <h2>Add New Problem / Cause / Effect</h2>
            <form method="post">
                {% csrf_token %}
                {{ form.as_p }}
                <button type="submit" class="btn btn-primary w-100 mt-3">Add to Analysis</button> </form>
        </div>
    </div>
</body>
</html>