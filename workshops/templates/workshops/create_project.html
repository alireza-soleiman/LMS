{% extends "base.html" %}
{% block title %}Create Project{% endblock %}
{% block content %}
<div class="container py-5" style="max-width:900px;">
  <h2>Create project</h2>
  <p class="text-muted">Provide project details and group members.</p>

  <form id="createProjectForm" method="post">
    {% csrf_token %}
    <div class="mb-3">
      {{ form.title.label_tag }} {{ form.title }}
    </div>
    <div class="mb-3">
      {{ form.group_name.label_tag }} {{ form.group_name }}
    </div>
    <div class="mb-3">
      {{ form.description.label_tag }} {{ form.description }}
    </div>

    <hr>
    <h5>Group members</h5>
    <p class="text-muted small">Add members (informational only).</p>

    <div id="membersContainer"></div>

    <div class="mt-3 d-flex gap-2">
      <button type="button" id="addMemberBtn" class="btn btn-outline-secondary btn-sm">➕ Add member</button>
      <button type="submit" class="btn btn-success">Create Project</button>
    </div>

    <!-- hidden field to carry JSON list of members -->
    <input type="hidden" name="members_json" id="members_json">
  </form>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const container = document.getElementById("membersContainer");
  const addBtn = document.getElementById("addMemberBtn");
  const membersInput = document.getElementById("members_json");

  function addMemberRow(data = {}) {
    const idx = container.children.length;
    const row = document.createElement("div");
    row.className = "row g-2 align-items-center mb-2 member-row";
    row.innerHTML = `
      <div class="col-3"><input class="form-control" placeholder="First name" name="m_first_${idx}" value="${data.first||''}"></div>
      <div class="col-3"><input class="form-control" placeholder="Last name" name="m_last_${idx}" value="${data.last||''}"></div>
      <div class="col-3"><input class="form-control" placeholder="Student number" name="m_num_${idx}" value="${data.number||''}"></div>
      <div class="col-2"><input class="form-control" placeholder="Email" name="m_email_${idx}" value="${data.email||''}"></div>
      <div class="col-1"><button type="button" class="btn btn-sm btn-outline-danger remove-member">✖</button></div>
    `;
    container.appendChild(row);

    row.querySelector(".remove-member").addEventListener("click", () => {
      row.remove();
    });
  }

  addBtn.addEventListener("click", () => addMemberRow());

  // On submit, gather rows into JSON
  document.getElementById("createProjectForm").addEventListener("submit", (e) => {
    const rows = container.querySelectorAll(".member-row");
    const list = [];
    rows.forEach((r, i) => {
      const first = r.querySelector(`[name="m_first_${i}"]`)?.value || "";
      const last = r.querySelector(`[name="m_last_${i}"]`)?.value || "";
      const number = r.querySelector(`[name="m_num_${i}"]`)?.value || "";
      const email = r.querySelector(`[name="m_email_${i}"]`)?.value || "";
      if (first || last || number || email) {
        list.push({ first, last, number, email });
      }
    });
    membersInput.value = JSON.stringify(list);
    // allow submission
  });

  // start with one empty member row
  addMemberRow();
});
</script>
{% endblock %}
