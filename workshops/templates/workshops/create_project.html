{% extends "base.html" %}
{% block title %}Create New Project â€” Academic LMS{% endblock %}

{% block content %}
<style>
  body {
    background: #f8fafc;
    font-family: "Inter", sans-serif;
  }
  .create-container {
    max-width: 850px;
    margin: 2rem auto;
    background: #fff;
    border-radius: 1rem;
    box-shadow: 0 8px 25px rgba(0,0,0,0.08);
    padding: 2.5rem 3rem;
    animation: fadeIn 0.6s ease-in-out;
  }
  h2 {
    font-weight: 600;
    color: #2c3e50;
  }
  .progress-text {
    font-size: 0.9rem;
    color: #6c757d;
    margin-bottom: 1.2rem;
  }
  .form-control {
    border-radius: 0.5rem;
  }
  .btn-primary {
    background-color: #0056b3;
    border: none;
    border-radius: 0.5rem;
    font-weight: 500;
    padding: 0.7rem 2rem;
  }
  .btn-primary:hover { background-color: #004291; }
  .member-row {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 0.7rem;
  }
  .member-row input {
    flex: 1;
  }
  .remove-btn {
    border: none;
    background: #f8d7da;
    color: #a33;
    border-radius: 0.4rem;
    padding: 0 0.7rem;
    font-weight: 600;
  }
  .remove-btn:hover { background: #f5c2c7; }
  .add-btn {
    border: 1px solid #0056b3;
    color: #0056b3;
    border-radius: 0.5rem;
    padding: 0.4rem 1.2rem;
    font-weight: 500;
  }
  .add-btn:hover { background: #0056b3; color: white; }
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }
</style>

<div class="create-container">
  <h2>ðŸ§± Step 1 of 4 â€” Create Your Project</h2>
  <p class="progress-text">Set up your project details and team members to begin.</p>
  <hr class="mb-4">

  <form method="post" id="createProjectForm">
    {% csrf_token %}

    <div class="mb-3">
      <label for="id_title" class="form-label">Project Title</label>
      <input type="text" name="title" id="id_title" class="form-control" placeholder="e.g. Interactive Web Pages" required>
    </div>

    <div class="mb-3">
      <label for="id_description" class="form-label">Project Description</label>
      <textarea name="description" id="id_description" class="form-control" rows="3" placeholder="Briefly describe your project goals..."></textarea>
    </div>

    <div class="mb-3">
      <label class="form-label">Team Members</label>
      <div id="membersContainer"></div>
      <button type="button" id="addMemberBtn" class="add-btn mt-2">+ Add Member</button>
      <input type="hidden" name="members_json" id="members_json">
    </div>

    <div class="text-center mt-4">
      <button type="submit" class="btn btn-primary px-5">Save & Continue â†’</button>
    </div>
  </form>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const container = document.getElementById("membersContainer");
  const addBtn = document.getElementById("addMemberBtn");
  const membersInput = document.getElementById("members_json");

  function updateHiddenInput() {
    const members = [];
    container.querySelectorAll(".member-row").forEach(row => {
      const first = row.querySelector(".first").value.trim();
      const last = row.querySelector(".last").value.trim();
      const email = row.querySelector(".email").value.trim();
      const num = row.querySelector(".num").value.trim();
      if (first || last || email || num) {
        members.push({ first, last, email, number: num });
      }
    });
    membersInput.value = JSON.stringify(members);
  }

  function addMemberRow(data = {}) {
    const row = document.createElement("div");
    row.className = "member-row";
    row.innerHTML = `
      <input type="text" class="form-control first" placeholder="First name" value="${data.first || ''}">
      <input type="text" class="form-control last" placeholder="Last name" value="${data.last || ''}">
      <input type="text" class="form-control num" placeholder="Student number" value="${data.number || ''}">
      <input type="email" class="form-control email" placeholder="Email" value="${data.email || ''}">
      <button type="button" class="remove-btn">Ã—</button>
    `;
    row.querySelector(".remove-btn").addEventListener("click", () => {
      row.remove();
      updateHiddenInput();
    });
    ["input", "change"].forEach(evt => row.addEventListener(evt, updateHiddenInput));
    container.appendChild(row);
    updateHiddenInput();
  }

  addBtn.addEventListener("click", () => addMemberRow());
});
</script>
{% endblock %}
